---
title: BackupSession Overview
menu:
  product_stash_0.8.3:
    identifier: backupsession-overview
    name: BackupSession
    parent: crds
    weight: 20
product_name: stash
menu_name: product_stash_0.8.3
section_menu_id: concepts
---

> New to Stash? Please start [here](/docs/concepts/README.md).

# BackupSession

## What is BackupSession

A `BackupSession` is a Kubernetes `CustomResourceDefinition (CRD)` which represents a backup instance of the respective target pointed by a `BackupConfiguration` in Kubernetes native way.

When a backup schedule appears, the respective `CronJob` creates a `BackupSession` object. It points to the respective `BackupConfiguration`. Controller that runs inside backup sidecar (in case of backup through job, it is stash operator itself) watches this `BackupSession` object and start taking backup instantly.

You can also create a `BackupSession` object manually to trigger backup instantly.

>In this tutorial, we are going to use **host** word to indicate an entity (pod) whose data is backed up.

>- For `Deployment`, `ReplicationController` and `ReplicaSet`, backup process run in only one pod. This pod is referred as **host-0**.
>- For `StatefulSet`, backup process run in all pods. In this case, **pod-0** is known as **host-0**, **pod-1** is known as **host-1**, **pod-2** is known as **host-2** and so on.
>- For `DaemonSet`, backup process run in all daemon pods. In this case, the **node name** where the pod is running act as their **host** name.
>- For database or stand-alone PVC, backup is done by a job. In this case, the backup job's pod is known as **host-0**.

## BackupSession CRD Specification

Like other official Kubernetes resources, `BackupSession` has `TypeMeta`, `ObjectMeta` and `Spec` , `Status` sections.

A sample `BackupSession` created for backing up a Deployment's data is shown below,

```yaml
apiVersion: stash.appscode.com/v1beta1
kind: BackupSession
metadata:
  name: deployment-backup-2do7af
  namespace: demo
  labels:
    backup-configuration: deployment-backup
spec:
  backupConfiguration:
    name: deployment-backup
status:
  phase: Succeeded
  totalHosts: 1
  sessionDuration: 3.861369766s
  stats:
  - hostname: host-0
    phase: Succeeded
    duration: 3.861369766s
    snapshots:
    - directory: /source/data
      fileStats:
        modifiedFiles: 0
        newFiles: 0
        totalFiles: 2
        unmodifiedFiles: 2
      name: ea5381cc
      processingTime: 0m0s
      size: 30 B
      uploaded: 0 B
```

Here, we are going to describe some important sections of `BackupSession` crd.

### BackupSession `Metadata` Section

#### metadata.name

`metadata.name` indicates the name of the `BackupSession`. This name is automatically generated by respective `CronJob` and it follows the following pattern: `<BackupConfiguration name>-<random suffix>`.

#### metadata.namespace

`metadata.namespace` indicates the name of the `BackupSession`. It is same as the namespace of respective `BackupConfiguration` object.

#### metadata.labels

`metadata.labels` holds respective `BackupConfiguration` name as label. Stash backup sidecar container use this label to watch only the BackupSessions of that `BackupConfiguration`.

>If you create `BackupSession` manually to trigger a backup instantly, make sure that you have added `backup-configuration: <BackupConfiguration name>` label to your `BackupSession`. Otherwise, it will not trigger backup for workloads (those resources that are backed up using sidecar).

### BackupSession `Spec` Section

BackupSession object has the following fields in `.spec` section:

#### spec.backupConfiguration

`spec.backupConfiguration.name` indicates the name of the `BackupConfiguration` object whose target will be triggered to take backup instantly by this `BackupSession`.

### BackupSession `Status` Section

`.status` section of `BackupSession` shows progress, stats and overall phase of backup process in this session. Backup sidecar container or job update their respective filed of this `.status` after they complete their task. `.status` section consist of following fields:

#### status.phase

`status.phase` indicates the overall phase of the backup process for this BackupSession. `status.phase` will be `Succeeded` only if the phase of all hosts are `Succeeded`. If any of the hosts fail to complete backup, `status.phase` will be `Failed`.

#### status.totalHosts

A `BackupSession` may trigger backup of multiple hosts. For example, all the pod's of a `Deployment`, `ReplicaSet` and `ReplicationController` mounts same volume. In this case, Stash will backup data only from one pod. Thus, the total number of hosts for these workloads will be 1. On the other hand, pods of `StatefulSet` and `DaemonSet` may have different volume mounted into different replica. In this case, Stash will backup data from all individual pods. Thus, the total number of hosts for these workloads will be number of replicas for `StatefulSet` and number of running daemon pods for `DaemonSet`.

#### status.sessionDuration

`status.sessionDuration` indicates the total time taken to complete backup of all hosts in this session. It is simply the sum of backup duration of all individual hosts.

#### status.stats

`status.stats` section is an array of backup statistics of individual hosts. Each host adds their statistics in this array after completing their backup process.

Individual host stats entry consist of following fields:

- **hostname :** `hostname` indicates the name of the host.
- **phase :** `phase` indicates the backup phase of this host.
- **duration :** `duration` indicates the total time taken to complete backup for this host.
- **snapshots :** Stash creates one snapshot for each target directories specified in `spec.target.directories` field of `BackupConfiguration` object. `snapshots` field holds statistics of each of these individual snapshots. Each snapshot statistics has following fields:
  - **name :** `name` indicates the name of the snapshot.
  - **directory :** `directory` indicates the directory that was backed up in this snapshot.
  - **size :** `size` indicates the size of data to backup from this directory.
  - **uploaded :** `uploaded` indicates size of data that was uploaded to backend for this snapshot. This could be much smaller than `size` if some data was already uploaded in the backend in the previous backup session.
  - **processingTime :** `processingTime` indicates the time taken to process the data of target directory.
  - **fileStats :** `fileStats` field show statics of files that were backed up in this snapshot.
    - **totalFiles :** `totalFiles` shows the total number of files that were backed up in this snapshot.
    - **newFiles :** `newFiles` shows the number of new files that were backed up in this snapshot.
    - **modifiedFiles :** `modifiedFiles` shows the number of files that were modified since last backup of this directory.
    - **unmodifiedFiles :** `unmodifiedFiles` shows the number of files that hasn't been changed since last backup of this directory.
- **error :** `error` shows the reason for failure if the backup process fail for this host.

## Next Steps

- Learn how backup of workloads data works from [here](/docs/guides/workloads/backup.md).
- Learn how backup of databases works from [here](/docs/guides/databases/backup.md).
- Learn how backup stand alone PVC works from [here](/docs/guides/volumes/backup.md).
